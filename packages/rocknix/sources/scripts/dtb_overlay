#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2024 ROCKNIX (https://github.com/ROCKNIX)

get_current_overlay() {
  grep FDTOVERLAYS /flash/extlinux/extlinux.conf | cut -d '/' -f 3
}

case "$1" in
  "")
    get_current_overlay
    ;;
  *)
    mount -o remount,rw /flash
    if grep --quiet FDTOVERLAYS /flash/extlinux/extlinux.conf; then
        sed -i "/FDTOVERLAYS \//c \ \ FDTOVERLAYS /overlays/${1}" /flash/extlinux/extlinux.conf
    else
        sed -i "/FDTDIR \//a \ \ FDTOVERLAYS /overlays/${1}" /flash/extlinux/extlinux.conf
    fi
    exit 0
    ;;
esac
