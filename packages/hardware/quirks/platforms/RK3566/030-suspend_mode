#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2023 JELOS (https://github.com/JustEnoughLinuxOS)

# If Android is detected on eMMC then disable sleep, it doesn't work with the Anbernic bootloader.
if [ -e "/dev/mmcblk0p14" ]; then
  /usr/bin/suspendmode off

  cat <<EOF >~/.config/logind.conf.d/login.conf
[Login]
HandlePowerKey=ignore
HandleSuspendKey=ignore
EOF
else
  . /etc/profile.d/001-functions

  MYSLEEPMODE=$(get_setting system.suspendmode)
  [ -z "${MYSLEEPMODE}" ] && /usr/bin/suspendmode mem

  [ -e "~/.config/logind.conf.d/login.conf" ] && rm -f ~/.config/logind.conf.d/login.conf
fi
